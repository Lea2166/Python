{% extends 'base.html' %}

{% block content %}
<style>
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-task {
        opacity: 0;
        animation: fadeInUp 0.5s ease-out forwards;
    }
    .status-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
</style>

<div class="min-h-screen bg-slate-950 p-4 md:p-8 text-slate-200 font-sans" dir="rtl">
    <div class="max-w-5xl mx-auto space-y-8">

        <div class="bg-slate-900 border border-slate-800 shadow-2xl rounded-3xl p-6 md:p-8 transform transition-all hover:scale-[1.01] duration-500">
            <div class="flex flex-col md:flex-row justify-between items-center gap-6">
                <div class="space-y-2 text-right w-full">
                    <h1 class="text-4xl font-black text-white tracking-tighter">ניהול משימות</h1>
                    <p class="text-slate-400 font-bold text-lg">צוות: <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-500">{{ team_name }}</span></p>
                </div>
            </div>
        </div>

        <div class="bg-slate-900 border border-slate-800 rounded-[2rem] shadow-xl p-6 space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="space-y-4">
                    <p class="text-xs font-black text-slate-500 uppercase tracking-widest mr-2 text-right">הצג משימות של:</p>
                    <div class="flex flex-wrap gap-3 justify-start">
                        {% for o_val, o_label in owner_options %}
                        <a href="?owner={{ o_val }}&status={{ status_filter }}" class="relative inline-flex items-center justify-center p-0.5 overflow-hidden text-xs font-bold rounded-xl group transition-transform hover:scale-105 {% if owner_filter == o_val %} bg-gradient-to-br from-purple-600 to-blue-500 {% else %} bg-slate-800 {% endif %}">
                            <span class="relative px-5 py-2 transition-all ease-in duration-75 bg-slate-900 rounded-xl group-hover:bg-transparent">{{ o_label }}</span>
                        </a>
                        {% endfor %}
                    </div>
                </div>
                <div class="space-y-4">
                    <p class="text-xs font-black text-slate-500 uppercase tracking-widest mr-2 text-right">לפי סטטוס:</p>
                    <div class="flex flex-wrap gap-3 justify-start">
                        {% for s_val, s_label in status_options %}
                        <a href="?owner={{ owner_filter }}&status={{ s_val }}" class="relative inline-flex items-center justify-center p-0.5 overflow-hidden text-[10px] font-bold rounded-xl group transition-transform hover:scale-105 {% if status_filter == s_val %} bg-gradient-to-br from-purple-600 to-blue-500 {% else %} bg-slate-800 {% endif %}">
                            <span class="relative px-4 py-2 transition-all ease-in duration-75 bg-slate-900 rounded-xl group-hover:bg-transparent uppercase">{{ s_label }}</span>
                        </a>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-slate-900 border border-slate-800 shadow-2xl rounded-[2.5rem] overflow-hidden">
            <ul class="divide-y divide-slate-800/50">
                {% for task in tasks %}
                <li class="p-8 hover:bg-slate-800/20 transition-all group animate-task" style="animation-delay: 0.{{ forloop.counter0 }}s">
                    <div class="flex flex-col md:flex-row items-center gap-6 text-right">

                        <div class="shrink-0 relative">
                            <div class="w-16 h-16 rounded-2xl flex items-center justify-center border-2 transition-all duration-500 group-hover:rotate-12
                                {% if task.Status == 'NEW' %} bg-blue-500/10 border-blue-500/40 text-blue-400 shadow-[0_0_15px_rgba(59,130,246,0.2)]
                                {% elif task.Status == 'IN_PROGRESS' %} bg-orange-500/10 border-orange-500/40 text-orange-400 shadow-[0_0_15px_rgba(249,115,22,0.2)]
                                {% else %} bg-emerald-500/10 border-emerald-500/40 text-emerald-400 shadow-[0_0_15px_rgba(16,185,129,0.2)] {% endif %}">
                                <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>
                            </div>
                            {% if task.Status == 'IN_PROGRESS' %}
                                <span class="absolute -top-1 -right-1 flex h-4 w-4">
                                    <span class="status-pulse absolute inline-flex h-full w-full rounded-full bg-orange-400 opacity-75"></span>
                                    <span class="relative inline-flex rounded-full h-4 w-4 bg-orange-500 border-2 border-slate-900"></span>
                                </span>
                            {% endif %}
                        </div>

                        <div class="flex-1 space-y-2">
                            <div class="flex flex-wrap items-center gap-3">
                                <h3 class="text-2xl font-black text-white group-hover:text-purple-400 transition-colors duration-300">{{ task.Name }}</h3>
                                <span class="px-3 py-1 rounded-lg text-[10px] font-black tracking-widest border
                                    {% if task.Status == 'NEW' %} border-blue-500/30 bg-blue-500/10 text-blue-400
                                    {% elif task.Status == 'IN_PROGRESS' %} border-orange-500/30 bg-orange-500/10 text-orange-400
                                    {% else %} border-emerald-500/30 bg-emerald-500/10 text-emerald-400 {% endif %}">
                                    {{ task.get_Status_display }}
                                </span>
                            </div>
                            <div class="flex flex-wrap gap-6 text-sm text-slate-500">
                                <span class="flex items-center gap-2 bg-slate-950/50 px-3 py-1 rounded-lg border border-slate-800">
                                    <svg class="w-4 h-4 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                    יעד: <span class="text-slate-300 font-bold">{{ task.Due_Date|date:"d/m/Y" }}</span>
                                </span>
                                <span class="flex items-center gap-2 bg-slate-950/50 px-3 py-1 rounded-lg border border-slate-800">
                                    <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                                    מבצע: <span class="text-slate-300">{{ task.AssignedUser.username|default:"טרם שויך" }}</span>
                                </span>
                            </div>
                        </div>

                        <div class="flex gap-3 self-end md:self-center">
                            {% if not task.AssignedUser and user_role == 'EMPLOYEE' %}
                                <a href="{% url 'claim_task' task.Id %}" class="relative inline-flex items-center justify-center p-0.5 overflow-hidden text-sm font-black rounded-xl group bg-gradient-to-br from-purple-600 to-blue-500 transition-all transform active:scale-95">
                                    <span class="relative px-6 py-2.5 transition-all ease-in duration-75 bg-slate-900 rounded-xl group-hover:bg-transparent">שייך אלי</span>
                                </a>
                            {% endif %}

                            {% if task.AssignedUser == request.user and task.Status == 'IN_PROGRESS' %}
                                <a href="{% url 'finish_task' task.Id %}" class="relative inline-flex items-center justify-center p-0.5 overflow-hidden text-sm font-black rounded-xl group bg-gradient-to-br from-emerald-400 to-blue-600 transition-all transform active:scale-95">
                                    <span class="relative px-6 py-2.5 transition-all ease-in duration-75 bg-slate-900 rounded-xl group-hover:bg-transparent text-emerald-400 group-hover:text-white">סיום משימה!</span>
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </li>
                {% empty %}
                <div class="p-24 text-center opacity-40">
                    <p class="text-slate-500 text-xl font-black italic tracking-widest">NO TASKS FOUND</p>
                </div>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}