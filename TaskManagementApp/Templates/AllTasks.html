{% extends 'base.html' %}

{% block content %}
<style>
 @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
 .animate-task { opacity: 0; animation: fadeInUp 0.5s ease-out forwards; }
 .status-pulse { animation: pulse 2s infinite; }
</style>

<div class="min-h-screen bg-slate-950 p-4 md:p-8 text-slate-200 font-sans" dir="rtl">
 <div class="max-w-6xl mx-auto space-y-8">

 <div class="bg-slate-900 border border-slate-800 shadow-2xl rounded-3xl p-6 md:p-8 flex flex-col md:flex-row justify-between items-center gap-6">
 <div class="space-y-2 text-right w-full">
 <h1 class="text-4xl font-black text-white tracking-tighter">
 {% if user_role == 'ADMIN' %}לוח בקרה מנהל{% else %}ניהול משימות{% endif %}
 </h1>
 <p class="text-slate-400 font-bold text-lg">תצוגה: <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-500">{{ team_name }}</span></p>
 </div>
 {% if user_role == 'ADMIN' %}
 <div class="flex gap-4 items-center">
 <a href="{% url 'add_task' %}" class="relative inline-flex items-center justify-center p-0.5 overflow-hidden text-sm font-bold rounded-xl group bg-gradient-to-br from-purple-600 to-blue-500 text-white shrink-0">
 <span class="relative px-6 py-2.5 transition-all bg-slate-900 rounded-xl group-hover:bg-transparent">+ משימה חדשה</span>
 </a>
 </div>
 {% endif %}
 </div>

 <div class="bg-slate-900 border border-slate-800 rounded-[2rem] shadow-xl p-6 flex flex-wrap gap-10">
 <div class="space-y-3">
 <p class="text-xs font-black text-slate-500 uppercase tracking-widest mr-2">סינון:</p>
 <div class="flex flex-wrap gap-3">
 {% for o_val, o_label in owner_options %}
 {% if user_role == 'ADMIN' and o_val == 'mine' %}
 {% else %}
 <a href="?owner={{ o_val }}&status={{ status_filter }}"
 class="relative inline-flex items-center justify-center p-0.5 overflow-hidden text-xs font-bold rounded-xl group {% if owner_filter == o_val %} bg-gradient-to-br from-purple-600 to-blue-500 {% else %} bg-slate-800 {% endif %}">
 <span class="relative px-5 py-2 transition-all ease-in duration-75 bg-slate-900 rounded-xl group-hover:bg-transparent leading-5">
 {{ o_label }}
 </span>
 </a>
 {% endif %}
 {% endfor %}
 </div>
 </div>
 <div class="space-y-3">
 <p class="text-xs font-black text-slate-500 uppercase tracking-widest mr-2">סטטוס:</p>
 <div class="flex flex-wrap gap-3">
 {% for s_val, s_label in status_options %}
 <a href="?owner={{ owner_filter }}&status={{ s_val }}" class="relative inline-flex items-center justify-center p-0.5 overflow-hidden text-[10px] font-bold rounded-xl group {% if status_filter == s_val %} bg-gradient-to-br from-purple-600 to-blue-500 {% else %} bg-slate-800 {% endif %}">
 <span class="relative px-4 py-2 bg-slate-900 rounded-xl group-hover:bg-transparent uppercase">{{ s_label }}</span>
 </a>
 {% endfor %}
 </div>
 </div>
 </div>

 <div class="bg-slate-900 border border-slate-800 shadow-2xl rounded-[2.5rem] overflow-hidden">
 <ul class="divide-y divide-slate-800/50">
 {% for task in tasks %}
 <li class="p-8 hover:bg-slate-800/20 transition-all group animate-task" style="animation-delay: 0.{{ forloop.counter0 }}s">
 <div class="flex flex-col md:flex-row items-center gap-6 text-right">

 <div class="shrink-0 relative">
 <div class="w-16 h-16 rounded-2xl flex items-center justify-center border-2
 {% if task.Status == 'NEW' %} border-blue-500/40 text-blue-400 bg-blue-500/5
 {% elif task.Status == 'IN_PROGRESS' %} border-orange-500/40 text-orange-400 bg-orange-500/5
 {% else %} border-emerald-500/40 text-emerald-400 bg-emerald-500/5 {% endif %}">
 <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>
 </div>
 </div>

 <div class="flex-1 space-y-2">
 <div class="flex flex-wrap items-center gap-3">
 <h3 class="text-2xl font-black text-white group-hover:text-purple-400 transition-all">{{ task.Name }}</h3>
 <span class="text-[10px] px-2 py-1 rounded-lg border border-slate-700 bg-slate-800 text-slate-400 font-black uppercase">{{ task.Teams.Name }}</span>
 </div>
 <div class="flex flex-wrap gap-4 text-sm text-slate-500">
 <span>יעד: <span class="text-slate-300">{{ task.Due_Date|date:"d/m/Y" }}</span></span>
 <span>מבצע: <span class="text-blue-400">{{ task.AssignedUser.username|default:"טרם שויך" }}</span></span>
 </div>
 </div>

 <div class="flex gap-3">
 {% if user_role == 'ADMIN' %}
 {% if not task.AssignedUser %}
 <a href="{% url 'edit_task' task.Id %}" class="p-2.5 bg-slate-800 text-blue-400 rounded-xl hover:bg-blue-500/10 transition-all" title="ערוך משימה">
 <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
 </a>
 <a href="{% url 'delete_task' task.Id %}" onclick="return confirm('למחוק לצמיתות?')" class="p-2.5 bg-slate-800 text-rose-500 rounded-xl hover:bg-rose-500/10 transition-all" title="מחק משימה">
 <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
 </a>
 {% endif %}
 {% endif %}

 {% if not task.AssignedUser and user_role == 'EMPLOYEE' %}
 <a href="{% url 'claim_task' task.Id %}" class="px-6 py-2.5 bg-gradient-to-br from-purple-600 to-blue-500 rounded-xl font-bold text-sm">שייך אלי</a>
 {% endif %}

 {% if task.AssignedUser == request.user and task.Status == 'IN_PROGRESS' %}
 <a href="{% url 'finish_task' task.Id %}" class="px-6 py-2.5 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-xl font-bold text-sm">סיימתי</a>
 {% endif %}
 </div>
 </div>
 </li>
 {% endfor %}
 </ul>
 </div>
 </div>
</div>
{% endblock %}