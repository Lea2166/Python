{% extends 'base.html' %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<style>
    :root {
        color-scheme: dark !important;
    }

    /* Flatpickr Calendar Styling */
    .flatpickr-calendar {
        background: #1e293b !important;
        border: 1px solid #334155 !important;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.6) !important;
        border-radius: 1.5rem !important;
        direction: ltr !important; /* Set to LTR for English */
        width: 310px !important;
    }

    /* Header styling: Month and Year */
    .flatpickr-current-month {
        display: flex !important;
        flex-direction: row !important; /* Standard English direction */
        align-items: center !important;
        justify-content: center !important;
        gap: 10px !important;
        color: white !important;
        padding: 5px 0 !important;
        font-weight: 800 !important;
    }

    /* Year Input Styling */
    .numInputWrapper {
        width: 65px !important;
    }
    .numInputWrapper input.cur-year {
        background: transparent !important;
        color: white !important;
        border: none !important;
        font-weight: 800 !important;
        padding: 0 !important;
        margin: 0 !important;
    }

    .numInputWrapper span {
        border-left: 1px solid rgba(255,255,255,0.1) !important;
    }

    /* Month Dropdown Styling */
    .flatpickr-monthDropdown-months {
        background-color: #1e293b !important;
        color: white !important;
        font-weight: 800 !important;
        border: none !important;
        padding: 2px 8px !important;
        border-radius: 8px !important;
        cursor: pointer !important;
    }

    /* Arrow Styling */
    .flatpickr-prev-month svg, .flatpickr-next-month svg {
        fill: #a855f7 !important;
        transition: transform 0.2s;
    }
    .flatpickr-prev-month:hover svg, .flatpickr-next-month:hover svg {
        transform: scale(1.2);
    }

    /* Weekdays Styling */
    .flatpickr-weekday {
        color: #94a3b8 !important;
        font-weight: 700 !important;
    }

    /* Day Numbers Styling */
    .flatpickr-day {
        color: white !important;
        border-radius: 10px !important;
    }
    .flatpickr-day.today {
        border-color: #a855f7 !important;
    }
    .flatpickr-day.selected {
        background: #a855f7 !important;
        border-color: #a855f7 !important;
        box-shadow: 0 0 10px rgba(168, 85, 247, 0.4);
    }

    /* Hide default browser indicator */
    input[type="date"]::-webkit-calendar-picker-indicator {
        display: none !important;
    }

    /* Premium Input Styling */
    input, textarea, select {
        background-color: #1e293b !important;
        border: 1px solid #334155 !important;
        color: white !important;
        border-radius: 1.25rem !important;
        padding: 1.25rem 1.25rem 1.25rem 3.5rem !important;
        width: 100% !important;
        outline: none !important;
        font-size: 1rem !important;
        transition: all 0.3s;
    }
    input:focus {
        border-color: #a855f7 !important;
        box-shadow: 0 0 0 4px rgba(168, 85, 247, 0.1) !important;
    }

    .premium-header-icon {
        background: linear-gradient(135deg, rgba(168, 85, 247, 0.2), rgba(59, 130, 246, 0.2));
        border: 1px solid rgba(168, 85, 247, 0.3);
    }
</style>

<div class="min-h-screen bg-slate-950 flex items-center justify-center p-6 w-full" dir="ltr">
    <div class="max-w-xl w-full animate-in fade-in zoom-in duration-700">

        <div class="text-center mb-10">
            <div class="inline-flex p-5 rounded-3xl premium-header-icon mb-6">
                <svg class="w-12 h-12 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
            </div>
            <h1 class="text-5xl font-black text-white tracking-tighter mb-3">{{ title }}</h1>
            <p class="text-slate-400 font-medium text-lg italic">Enterprise Task Management</p>
        </div>

        <div class="bg-slate-900 border border-slate-800 rounded-[3rem] p-10 md:p-14 shadow-2xl relative overflow-hidden backdrop-blur-xl">
            <div class="absolute -top-24 -right-24 w-64 h-64 bg-purple-600/15 blur-[100px] rounded-full"></div>

            <form method="post" class="space-y-8 relative text-left">
                {% csrf_token %}

                {% for field in form %}
                <div class="space-y-3 group">
                    <label class="text-[11px] font-black text-slate-500 uppercase tracking-[0.2em] ml-1 group-focus-within:text-purple-400 transition-colors">
                        {{ field.label }}
                    </label>
                    <div class="relative flex items-center">
                        {{ field }}

                        {% if 'Due_Date' in field.name or 'date' in field.field.widget.attrs.type %}
                            <div class="absolute left-5 text-purple-500 pointer-events-none group-focus-within:scale-110 transition-transform">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}

                <div class="pt-8 flex flex-col sm:flex-row gap-5">
                    <button type="submit" class="flex-[2] py-5 bg-white text-slate-950 rounded-2xl font-black text-sm uppercase tracking-widest hover:bg-purple-50 transition-all transform hover:scale-[1.02] shadow-xl">
                        Save Changes
                    </button>
                    <a href="{% url 'alltasks' %}" class="flex-1 px-8 py-5 bg-slate-800 text-slate-400 rounded-2xl text-center font-bold text-sm hover:bg-slate-700 border border-slate-700 transition-all">
                        Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
    const userSelect = document.querySelector('select[name="AssignedUser"]');
    const teamSelect = document.querySelector('select[name="Teams"]');

    // אם אנחנו במצב של "הוספת משימה חדשה" (כלומר לא נבחר צוות עדיין)
    if (!teamSelect.value) {
        userSelect.innerHTML = '<option value="">---------</option>';
    }
});
    flatpickr("input[type='date']", {
        dateFormat: "Y-m-d",
        disableMobile: "true",
        minDate: "today", // הגבלה מהיום והלאה
    });
document.querySelector('select[name="Teams"]').addEventListener('change', function() {
    const teamId = this.value;
    const userSelect = document.querySelector('select[name="AssignedUser"]');

    // ניקוי הרשימה הנוכחית
    userSelect.innerHTML = '<option value="">---------</option>';

    if (teamId) {
        // פנייה לשרת לקבלת העובדים של הצוות שנבחר
        fetch(`/get-employees-by-team/?team_id=${teamId}`)
            .then(response => response.json())
            .then(data => {
                data.forEach(user => {
                    const option = new Option(user.username, user.id);
                    userSelect.add(option);
                });
            });
    }
});
</script>
{% endblock %}